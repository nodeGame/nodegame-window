<!DOCTYPE html>
<html>
<head>
  <title>GameWindow.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../doc-style.css" />
  <script src="../doc-filelist.js"></script>
  <script>
    var relativeDir = '../', thisFile = 'lib/GameWindow.js', defaultSidebar = true;
  </script>
  <script src="../doc-script.js"></script>
</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">
      <div class="heading h1">
        <a href="#gamewindow">GameWindow</a>
      </div>
      <div class="heading h2">
        <a href="#gamewindow-constructor">GameWindow constructor</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.framename">GameWindow.frameName</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.frameelement">GameWindow.frameElement</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.framewindow">GameWindow.frameWindow</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.framedocument">GameWindow.frameDocument</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.root">GameWindow.root</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.headerelement">GameWindow.headerElement</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.headername">GameWindow.headerName</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.headerroot">GameWindow.headerRoot</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.headerposition">GameWindow.headerPosition</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.defaultheaderposition">GameWindow.defaultHeaderPosition</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.conf">GameWindow.conf</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.urichannel">GameWindow.uriChannel</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.areloading">GameWindow.areLoading</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.cachesupported">GameWindow.cacheSupported</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.cachesupported">GameWindow.cacheSupported</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.cache">GameWindow.cache</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.currenturis">GameWindow.currentURIs</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.unprocesseduri">GameWindow.unprocessedUri</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.globallibs">GameWindow.globalLibs</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.framelibs">GameWindow.frameLibs</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.uriprefix">GameWindow.uriPrefix</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.statelevel">GameWindow.stateLevel</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.waitscreen">GameWindow.waitScreen</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.listenersadded">GameWindow.listenersAdded</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.screenstate">GameWindow.screenState</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.isie">GameWindow.isIE</a>
      </div>
      <div class="heading h2">
        <a href="#gamewindow-methods">GameWindow methods</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.init">GameWindow.init</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.reset">GameWindow.reset</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.setstatelevel">GameWindow.setStateLevel</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.getstatelevel">GameWindow.getStateLevel</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.isready">GameWindow.isReady</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.setscreenlevel">GameWindow.setScreenLevel</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.getscreenlevel">GameWindow.getScreenLevel</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.getframe">GameWindow.getFrame</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.getframename">GameWindow.getFrameName</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.getframewindow">GameWindow.getFrameWindow</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.getframedocument">GameWindow.getFrameDocument</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.getframeroot">GameWindow.getFrameRoot</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.generateframe">GameWindow.generateFrame</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.generateinfopanel">GameWindow.generateInfoPanel</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.setframe">GameWindow.setFrame</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.destroyframe">GameWindow.destroyFrame</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.clearframe">GameWindow.clearFrame</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.generateheader">GameWindow.generateHeader</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.setheaderposition">GameWindow.setHeaderPosition</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.setheader">GameWindow.setHeader</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.getheader">GameWindow.getHeader</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.getheadername">GameWindow.getHeaderName</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.getheaderroot">GameWindow.getHeaderRoot</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.destroyheader">GameWindow.destroyHeader</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.clearheader">GameWindow.clearHeader</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.initlibs">GameWindow.initLibs</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.precachetest">GameWindow.preCacheTest</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.precache">GameWindow.preCache</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.clearcache">GameWindow.clearCache</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.getelementbyid">GameWindow.getElementById</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.getelementsbytagname">GameWindow.getElementsByTagName</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.getelementsbyclassname">GameWindow.getElementsByClassName</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.loadframe">GameWindow.loadFrame</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.processuri">GameWindow.processUri</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.updateloadframestate">GameWindow.updateLoadFrameState</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.clearpagebody">GameWindow.clearPageBody</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.clearpage">GameWindow.clearPage</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.seturiprefix">GameWindow.setUriPrefix</a>
      </div>
      <div class="heading h3">
        <a href="#gamewindow.seturichannel">GameWindow.setUriChannel</a>
      </div>
      <div class="heading h2">
        <a href="#helper-functions">Helper functions</a>
      </div>
      <div class="heading h3">
        <a href="#handleframeload">handleFrameLoad</a>
      </div>
      <div class="heading h3">
        <a href="#removelibraries">removeLibraries</a>
      </div>
      <div class="heading h3">
        <a href="#reloadscripts">reloadScripts</a>
      </div>
      <div class="heading h3">
        <a href="#injectlibraries">injectLibraries</a>
      </div>
      <div class="heading h3">
        <a href="#updateareloading">updateAreLoading</a>
      </div>
      <div class="heading h3">
        <a href="#adaptframe2headerposition">adaptFrame2HeaderPosition</a>
      </div>
      <div class="heading h3">
        <a href="#testdirectframedocumentaccess">testDirectFrameDocumentAccess</a>
      </div>
    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container"><div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow">
  <h1>
    <a href="#gamewindow" class="pilcrow">&#182;</a>
    GameWindow
  </h1>
</div>


<p>Copyright(c) 2017 Stefano Balietti <a href="&#x6D;&#97;&#105;&#108;&#x74;&#x6F;:&#115;&#116;e&#x40;&#110;&#111;&#100;e&#x67;&#97;&#x6D;&#101;&#46;&#x6F;&#x72;g">&#115;&#116;e&#x40;&#110;&#111;&#100;e&#x67;&#97;&#x6D;&#101;&#46;&#x6F;&#x72;g</a>
MIT Licensed</p>
  </div>
  <div class="body"><p>API to interface nodeGame with the browser window</p>

<p>Creates a custom root element inside the HTML page, and insert an
iframe element inside it.</p>

<p>Dynamic content can be loaded inside the iframe without losing the
javascript state inside the page.</p>

<p>Defines a number of profiles associated with special page layout.</p>

<p>Depends on JSUS and nodegame-client.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nb">window</span><span class="p">,</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>

    <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">J</span><span class="p">,</span> <span class="nx">DOM</span><span class="p">;</span>

    <span class="kd">var</span> <span class="nx">constants</span><span class="p">,</span> <span class="nx">windowLevels</span><span class="p">,</span> <span class="nx">screenLevels</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">CB_EXECUTED</span><span class="p">,</span> <span class="nx">WIN_LOADING</span><span class="p">,</span> <span class="nx">lockedUpdate</span><span class="p">;</span>

    <span class="nx">J</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">JSUS</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">J</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow: JSUS not found. Aborting.&#39;</span><span class="p">);</span>
    <span class="nx">DOM</span> <span class="o">=</span> <span class="nx">J</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;DOM&#39;</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">DOM</span><span class="p">)</span> <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow: JSUS=&gt;DOM not found. Aborting.&#39;</span><span class="p">);</span>

    <span class="nx">constants</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">constants</span><span class="p">;</span>
    <span class="nx">windowLevels</span> <span class="o">=</span> <span class="nx">constants</span><span class="p">.</span><span class="nx">windowLevels</span><span class="p">;</span>
    <span class="nx">screenLevels</span> <span class="o">=</span> <span class="nx">constants</span><span class="p">.</span><span class="nx">screenLevels</span><span class="p">;</span>

    <span class="nx">CB_EXECUTED</span> <span class="o">=</span> <span class="nx">constants</span><span class="p">.</span><span class="nx">stageLevels</span><span class="p">.</span><span class="nx">CALLBACK_EXECUTED</span><span class="p">;</span>

    <span class="nx">WIN_LOADING</span> <span class="o">=</span> <span class="nx">windowLevels</span><span class="p">.</span><span class="nx">LOADING</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2">&#182;</a>
</div>
<p>Allows just one update at the time to the counter of loading frames.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">lockedUpdate</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span> <span class="o">=</span> <span class="nx">DOM</span><span class="p">;</span>
    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">constructor</span> <span class="o">=</span> <span class="nx">GameWindow</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3">&#182;</a>
</div>
<p>Configuration object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4">&#182;</a>
</div>
<p>Default settings.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">promptOnleaveText</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">promptOnleave</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">noEscape</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">waitScreen</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">disableRightClick</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">cacheDefaults</span> <span class="o">=</span> <span class="p">{</span>
        <span class="nx">loadCache</span><span class="o">:</span>       <span class="kc">true</span><span class="p">,</span>
        <span class="nx">storeCacheNow</span><span class="o">:</span>   <span class="kc">false</span><span class="p">,</span>
        <span class="nx">storeCacheLater</span><span class="o">:</span> <span class="kc">false</span>
    <span class="p">};</span>
    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">infoPanel</span> <span class="o">=</span> <span class="kc">undefined</span><span class="p">;</span>

    <span class="kd">function</span> <span class="nx">onLoadStd</span><span class="p">(</span><span class="nx">iframe</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">iframeWin</span><span class="p">;</span>
        <span class="nx">iframeWin</span> <span class="o">=</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">;</span>

        <span class="kd">function</span> <span class="nx">completed</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">iframeDoc</span><span class="p">;</span>
            <span class="nx">iframeDoc</span> <span class="o">=</span> <span class="nx">J</span><span class="p">.</span><span class="nx">getIFrameDocument</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5">&#182;</a>
</div>
<p>Detaching the function to avoid double execution.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">iframe</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">completed</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
            <span class="nx">iframeWin</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">completed</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6">&#182;</a>
</div>
<p>Some browsers fire onLoad too early.
A small timeout is enough.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">cb</span><span class="p">();</span> <span class="p">},</span> <span class="mi">120</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7">&#182;</a>
</div>
<p>Use the handy event callback</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">iframe</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">completed</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8">&#182;</a>
</div>
<p>A fallback to window.onload, that will always work</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">iframeWin</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="s1">&#39;load&#39;</span><span class="p">,</span> <span class="nx">completed</span><span class="p">,</span> <span class="kc">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">onLoadIE</span><span class="p">(</span><span class="nx">iframe</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">iframeWin</span><span class="p">;</span>
        <span class="nx">iframeWin</span> <span class="o">=</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9">&#182;</a>
</div>
<p>We cannot get the iframeDoc here and use it in completed. See below.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="kd">function</span> <span class="nx">completed</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">iframeDoc</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10">&#182;</a>
</div>
<p>IE &lt; 10 (also 11?) gives 'Permission Denied' if trying to access
the iframeDoc from the context of the function above.
We need to re-get it from the DOM.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">iframeDoc</span> <span class="o">=</span> <span class="nx">J</span><span class="p">.</span><span class="nx">getIFrameDocument</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11">&#182;</a>
</div>
<p>readyState === "complete" works also in oldIE.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">event</span><span class="p">.</span><span class="nx">type</span> <span class="o">===</span> <span class="s1">&#39;load&#39;</span> <span class="o">||</span>
                <span class="nx">iframeDoc</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="s1">&#39;complete&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12">&#182;</a>
</div>
<p>Detaching the function to avoid double execution.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="nx">iframe</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">(</span><span class="s1">&#39;onreadystatechange&#39;</span><span class="p">,</span> <span class="nx">completed</span> <span class="p">);</span>
                <span class="nx">iframeWin</span><span class="p">.</span><span class="nx">detachEvent</span><span class="p">(</span><span class="s1">&#39;onload&#39;</span><span class="p">,</span> <span class="nx">completed</span> <span class="p">);</span>

                <span class="k">if</span> <span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13">&#182;</a>
</div>
<p>Some browsers fire onLoad too early.
A small timeout is enough.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span> <span class="nx">cb</span><span class="p">();</span> <span class="p">},</span> <span class="mi">120</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14">&#182;</a>
</div>
<p>Ensure firing before onload, maybe late but safe also for iframes.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">iframe</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">&#39;onreadystatechange&#39;</span><span class="p">,</span> <span class="nx">completed</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15">&#182;</a>
</div>
<p>A fallback to window.onload, that will always work.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">iframeWin</span><span class="p">.</span><span class="nx">attachEvent</span><span class="p">(</span><span class="s1">&#39;onload&#39;</span><span class="p">,</span> <span class="nx">completed</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="kd">function</span> <span class="nx">onLoad</span><span class="p">(</span><span class="nx">iframe</span><span class="p">,</span> <span class="nx">cb</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16">&#182;</a>
</div>
<p>IE</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">W</span><span class="p">.</span><span class="nx">isIE</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">onLoadIE</span><span class="p">(</span><span class="nx">iframe</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17">&#182;</a>
</div>
<p>Standards-based browsers support DOMContentLoaded.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">onLoadStd</span><span class="p">(</span><span class="nx">iframe</span><span class="p">,</span> <span class="nx">cb</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow-constructor">
  <h2>
    <a href="#gamewindow-constructor" class="pilcrow">&#182;</a>
    GameWindow constructor
  </h2>
</div>

  </div>
  <div class="body"><p>Creates the GameWindow object</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.init
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">GameWindow</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setStateLevel</span><span class="p">(</span><span class="s1">&#39;UNINITIALIZED&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nb">window</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow: no window found. Are you in a &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;browser?&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">node</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow: nodeGame not found&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">node</span><span class="p">.</span><span class="nx">silly</span><span class="p">(</span><span class="s1">&#39;node-window: loading...&#39;</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.framename">
  <h3>
    <a href="#gamewindow.framename" class="pilcrow">&#182;</a>
    GameWindow.frameName
  </h3>
</div>

  </div>
  <div class="body"><p>The name (and also id) of the iframe where the pages are loaded</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">frameName</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.frameelement">
  <h3>
    <a href="#gamewindow.frameelement" class="pilcrow">&#182;</a>
    GameWindow.frameElement
  </h3>
</div>

  </div>
  <div class="body"><p>A reference to the iframe object of type <em>HTMLIFrameElement</em></p>

<p>You can get this element also by:</p>

<ul>
<li>document.getElementById(this.frameName)</li>
</ul>

<p>This is the element that contains the <em>Window</em> object of the iframe.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">this.frameName</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">this.frameWindow</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">this.frameDocument
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">frameElement</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.framewindow">
  <h3>
    <a href="#gamewindow.framewindow" class="pilcrow">&#182;</a>
    GameWindow.frameWindow
  </h3>
</div>

  </div>
  <div class="body"><p>A reference to the iframe Window object</p>

<p>You can get this element also by:</p>

<ul>
<li>window.frames[this.frameName]</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">frameWindow</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.framedocument">
  <h3>
    <a href="#gamewindow.framedocument" class="pilcrow">&#182;</a>
    GameWindow.frameDocument
  </h3>
</div>

  </div>
  <div class="body"><p>A reference to the iframe Document object</p>

<p>You can get this element also by:</p>

<ul>
<li>JSUS.getIFrameDocument(this.frameElement)</li>
</ul>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">this.frameElement</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">this.frameWindow
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">frameDocument</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.root">
  <h3>
    <a href="#gamewindow.root" class="pilcrow">&#182;</a>
    GameWindow.root
  </h3>
</div>

  </div>
  <div class="body"><p>A reference to the HTML element to which the iframe is appended</p>

<p>Under normal circumstances, this element is a reference to
<em>document.body</em>.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">frameRoot</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.headerelement">
  <h3>
    <a href="#gamewindow.headerelement" class="pilcrow">&#182;</a>
    GameWindow.headerElement
  </h3>
</div>

  </div>
  <div class="body"><p>A reference to the HTMLDivElement representing the header</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">headerElement</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.headername">
  <h3>
    <a href="#gamewindow.headername" class="pilcrow">&#182;</a>
    GameWindow.headerName
  </h3>
</div>

  </div>
  <div class="body"><p>The name (id) of the header element</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">headerName</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.headerroot">
  <h3>
    <a href="#gamewindow.headerroot" class="pilcrow">&#182;</a>
    GameWindow.headerRoot
  </h3>
</div>

  </div>
  <div class="body"><p>The name (id) of the header element</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">headerRoot</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.headerposition">
  <h3>
    <a href="#gamewindow.headerposition" class="pilcrow">&#182;</a>
    GameWindow.headerPosition
  </h3>
</div>

  </div>
  <div class="body"><p>The relative position of the header on the screen</p>

<p>Available positions: 'top', 'bottom', 'left', 'right'.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.setHeaderPosition
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">headerPosition</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.defaultheaderposition">
  <h3>
    <a href="#gamewindow.defaultheaderposition" class="pilcrow">&#182;</a>
    GameWindow.defaultHeaderPosition
  </h3>
</div>

  </div>
  <div class="body"><p>The default header position. 'left'.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">defaultHeaderPosition</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.conf">
  <h3>
    <a href="#gamewindow.conf" class="pilcrow">&#182;</a>
    GameWindow.conf
  </h3>
</div>

  </div>
  <div class="body"><p>Object containing the current configuration</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">conf</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.urichannel">
  <h3>
    <a href="#gamewindow.urichannel" class="pilcrow">&#182;</a>
    GameWindow.uriChannel
  </h3>
</div>

  </div>
  <div class="body"><p>The uri of the channel on the server</p>

<p>It is not the socket.io channel, but the HTTP address.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.loadFrame
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">uriChannel</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.areloading">
  <h3>
    <a href="#gamewindow.areloading" class="pilcrow">&#182;</a>
    GameWindow.areLoading
  </h3>
</div>

  </div>
  <div class="body"><p>The number of frames currently being loaded</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">areLoading</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.cachesupported">
  <h3>
    <a href="#gamewindow.cachesupported" class="pilcrow">&#182;</a>
    GameWindow.cacheSupported
  </h3>
</div>

  </div>
  <div class="body"><p>Flag that marks whether caching is supported by the browser</p>

<p>Caching requires to modify the documentElement.innerHTML property
of the iframe document, which is read-only in IE &lt; 9.</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">cacheSupported</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.cachesupported">
  <h3>
    <a href="#gamewindow.cachesupported" class="pilcrow">&#182;</a>
    GameWindow.cacheSupported
  </h3>
</div>

  </div>
  <div class="body"><p>Flag that direct access to the iframe content is allowed</p>

<p>Usually false, on IEs</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">testdirectFrameDocumentAccess
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">directFrameDocumentAccess</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.cache">
  <h3>
    <a href="#gamewindow.cache" class="pilcrow">&#182;</a>
    GameWindow.cache
  </h3>
</div>

  </div>
  <div class="body"><p>Cache for loaded iframes</p>

<p>Maps URI to a cache object with the following properties:</p>

<ul>
<li><code>contents</code> (the innerHTML property or null if not cached)</li>
<li>optionally 'cacheOnClose' (a bool telling whether to cache
the frame when it is replaced by a new one)</li>
</ul>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.currenturis">
  <h3>
    <a href="#gamewindow.currenturis" class="pilcrow">&#182;</a>
    GameWindow.currentURIs
  </h3>
</div>

  </div>
  <div class="body"><p>Currently loaded URIs in the internal frames</p>

<p>Maps frame names (e.g. 'ng_mainframe') to the (processed) URIs
that they are showing.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.preCache</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.processUri

TODO: check: this is still having the test frame, should it be
removed instead?
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">currentURIs</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.unprocesseduri">
  <h3>
    <a href="#gamewindow.unprocesseduri" class="pilcrow">&#182;</a>
    GameWindow.unprocessedUri
  </h3>
</div>

  </div>
  <div class="body"><p>The uri parameter passed to <code>loadFrame</code>, still unprocessed</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.currentURIs</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.processUri
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">unprocessedUri</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.globallibs">
  <h3>
    <a href="#gamewindow.globallibs" class="pilcrow">&#182;</a>
    GameWindow.globalLibs
  </h3>
</div>

  </div>
  <div class="body"><p>Array of strings with the path of the libraries
to be loaded in every frame</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">globalLibs</span> <span class="o">=</span> <span class="p">[];</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.framelibs">
  <h3>
    <a href="#gamewindow.framelibs" class="pilcrow">&#182;</a>
    GameWindow.frameLibs
  </h3>
</div>

  </div>
  <div class="body"><p>The libraries to be loaded in specific frames</p>

<p>Maps frame names to arrays of strings. These strings are the
libraries that should be loaded for a frame.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.globalLibs
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">frameLibs</span> <span class="o">=</span> <span class="p">{};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.uriprefix">
  <h3>
    <a href="#gamewindow.uriprefix" class="pilcrow">&#182;</a>
    GameWindow.uriPrefix
  </h3>
</div>

  </div>
  <div class="body"><p>A prefix added to every loaded uri that does not begin with <code>/</code></p>

<p>Useful for example to add a language path (e.g. a language
directory) that matches a specific context of a view.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.loadFrame</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">LanguageSelector (widget)
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">uriPrefix</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.statelevel">
  <h3>
    <a href="#gamewindow.statelevel" class="pilcrow">&#182;</a>
    GameWindow.stateLevel
  </h3>
</div>

  </div>
  <div class="body"><p>The window's state level</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">constants.windowLevels
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">stateLevel</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.waitscreen">
  <h3>
    <a href="#gamewindow.waitscreen" class="pilcrow">&#182;</a>
    GameWindow.waitScreen
  </h3>
</div>

  </div>
  <div class="body"><p>Reference to the <em>WaitScreen</em> module</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">node.widgets.WaitScreen
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">waitScreen</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.listenersadded">
  <h3>
    <a href="#gamewindow.listenersadded" class="pilcrow">&#182;</a>
    GameWindow.listenersAdded
  </h3>
</div>

  </div>
  <div class="body"><p>TRUE, if listeners were added already</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.addDefaultListeners
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">listenersAdded</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.screenstate">
  <h3>
    <a href="#gamewindow.screenstate" class="pilcrow">&#182;</a>
    GameWindow.screenState
  </h3>
</div>

  </div>
  <div class="body"><p>Level describing whether the user can interact with the frame</p>

<p>The <em>screen</em> represents all the user can see on screen.
It includes the <em>frame</em> area, but also the <em>header</em>.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">node.widgets.WaitScreen</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">node.constants.screenLevels
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">screenState</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">constants</span><span class="p">.</span><span class="nx">screenLevels</span><span class="p">.</span><span class="nx">ACTIVE</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.isie">
  <h3>
    <a href="#gamewindow.isie" class="pilcrow">&#182;</a>
    GameWindow.isIE
  </h3>
</div>

  </div>
  <div class="body"><p>Boolean flag saying whether we are in IE or not</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">isIE</span> <span class="o">=</span> <span class="o">!!</span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;span&#39;</span><span class="p">).</span><span class="nx">attachEvent</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45">&#182;</a>
</div>
<p>Add setup functions.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">addDefaultSetups</span><span class="p">();</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46">&#182;</a>
</div>
<p>Adding listeners.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">addDefaultListeners</span><span class="p">();</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47">&#182;</a>
</div>
<p>Hide noscript tag (necessary for IE8).</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">scriptTag</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">scriptTag</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="nx">scriptTag</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
            <span class="p">})(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;noscript&#39;</span><span class="p">));</span>
        <span class="p">},</span> <span class="mi">1000</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48">&#182;</a>
</div>
<p>Init.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">init</span><span class="p">(</span><span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">);</span>

        <span class="nx">node</span><span class="p">.</span><span class="nx">silly</span><span class="p">(</span><span class="s1">&#39;node-window: created.&#39;</span><span class="p">);</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="gamewindow-methods">
  <h2>
    <a href="#gamewindow-methods" class="pilcrow">&#182;</a>
    GameWindow methods
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.init">
  <h3>
    <a href="#gamewindow.init" class="pilcrow">&#182;</a>
    GameWindow.init
  </h3>
</div>

  </div>
  <div class="body"><p>Sets global variables based on local configuration</p>

<p>Defaults:
 - promptOnleave TRUE
 - captures ESC key</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">options</span>
      <span class="dox_type">object</span>
      <span>Optional. Configuration options</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">init</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">stageLevels</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">stageLevel</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">setStateLevel</span><span class="p">(</span><span class="s1">&#39;INITIALIZING&#39;</span><span class="p">);</span>
        <span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">{};</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">conf</span> <span class="o">=</span> <span class="nx">J</span><span class="p">.</span><span class="nx">merge</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">promptOnleave</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">promptOnleave</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">promptOnleave</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">restoreOnleave</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">noEscape</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">noEscape</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">noEscape</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">noEscape</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">restoreEscape</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">waitScreen</span> <span class="o">!==</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">waitScreen</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">waitScreen</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">waitScreen</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">waitScreen</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">node</span><span class="p">.</span><span class="nx">WaitScreen</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">waitScreen</span><span class="p">);</span>

            <span class="nx">stageLevels</span> <span class="o">=</span> <span class="nx">constants</span><span class="p">.</span><span class="nx">stageLevels</span><span class="p">;</span>
            <span class="nx">stageLevel</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">getStageLevel</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">stageLevel</span> <span class="o">!==</span> <span class="nx">stageLevels</span><span class="p">.</span><span class="nx">UNINITIALIZED</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">paused</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">lockScreen</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">waitScreen</span><span class="p">.</span><span class="nx">defaultTexts</span><span class="p">.</span><span class="nx">paused</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">stageLevel</span> <span class="o">===</span> <span class="nx">stageLevels</span><span class="p">.</span><span class="nx">DONE</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">lockScreen</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">waitScreen</span><span class="p">.</span><span class="nx">defaultTexts</span><span class="p">.</span><span class="nx">waiting</span><span class="p">);</span>
                    <span class="p">}</span>
                    <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">stageLevel</span> <span class="o">!==</span> <span class="nx">stageLevels</span><span class="p">.</span><span class="nx">PLAYING</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nx">lockScreen</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">waitScreen</span><span class="p">.</span><span class="nx">defaultTexts</span><span class="p">.</span><span class="nx">stepping</span><span class="p">);</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">waitScreen</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">waitScreen</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">waitScreen</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">defaultHeaderPosition</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">defaultHeaderPosition</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">defaultHeaderPosition</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">disableRightClick</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">disableRightClick</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">disableRightClick</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">enableRightClick</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">disableBackButton</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">disableBackButton</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">disableBackButton</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">uriPrefix</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">setUriPrefix</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">uriPrefix</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">setStateLevel</span><span class="p">(</span><span class="s1">&#39;INITIALIZED&#39;</span><span class="p">);</span>

        <span class="nx">node</span><span class="p">.</span><span class="nx">silly</span><span class="p">(</span><span class="s1">&#39;node-window: inited.&#39;</span><span class="p">);</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.reset">
  <h3>
    <a href="#gamewindow.reset" class="pilcrow">&#182;</a>
    GameWindow.reset
  </h3>
</div>

  </div>
  <div class="body"><p>Resets the GameWindow to the initial state</p>

<p>Clears the frame, header, lock, widgets and cache.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">Widgets.destroyAll
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">reset</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52">&#182;</a>
</div>
<p>Unlock screen, if currently locked.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">isScreenLocked</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">unlockScreen</span><span class="p">();</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53">&#182;</a>
</div>
<p>Remove widgets, if Widgets exists.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">widgets</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">widgets</span><span class="p">.</span><span class="nx">destroyAll</span><span class="p">();</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54">&#182;</a>
</div>
<p>Remove loaded frame, if one is found.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getFrame</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">destroyFrame</span><span class="p">();</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55">&#182;</a>
</div>
<p>Remove header, if one is found.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getHeader</span><span class="p">())</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">destroyHeader</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">areLoading</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56">&#182;</a>
</div>
<p>Clear all caches.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">clearCache</span><span class="p">();</span>

        <span class="nx">node</span><span class="p">.</span><span class="nx">silly</span><span class="p">(</span><span class="s1">&#39;node-window: reseted.&#39;</span><span class="p">);</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.setstatelevel">
  <h3>
    <a href="#gamewindow.setstatelevel" class="pilcrow">&#182;</a>
    GameWindow.setStateLevel
  </h3>
</div>

  </div>
  <div class="body"><p>Validates and sets window's state level</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">level</span>
      <span class="dox_type">string</span>
      <span>The level of the update</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">constants.windowLevels
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setStateLevel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">level</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">level</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.setStateLevel: &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;level must be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">windowLevels</span><span class="p">[</span><span class="nx">level</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.setStateLevel: unrecognized level: &#39;</span> <span class="o">+</span>
                            <span class="nx">level</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">stateLevel</span> <span class="o">=</span> <span class="nx">windowLevels</span><span class="p">[</span><span class="nx">level</span><span class="p">];</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.getstatelevel">
  <h3>
    <a href="#gamewindow.getstatelevel" class="pilcrow">&#182;</a>
    GameWindow.getStateLevel
  </h3>
</div>

  </div>
  <div class="body"><p>Returns the current state level</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">number</span>
      <span>The state level</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">constants.windowLevels
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getStateLevel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">stateLevel</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.isready">
  <h3>
    <a href="#gamewindow.isready" class="pilcrow">&#182;</a>
    GameWindow.isReady
  </h3>
</div>

  </div>
  <div class="body"><p>Returns TRUE if the GameWindow is ready</p>

<p>The window is ready if its state is either INITIALIZED or LOADED.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">boolean</span>
      <span>TRUE if the window is ready</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">isReady</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">stateLevel</span> <span class="o">===</span> <span class="nx">windowLevels</span><span class="p">.</span><span class="nx">LOADED</span> <span class="o">||</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">stateLevel</span> <span class="o">===</span> <span class="nx">windowLevels</span><span class="p">.</span><span class="nx">INITIALIZED</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.setscreenlevel">
  <h3>
    <a href="#gamewindow.setscreenlevel" class="pilcrow">&#182;</a>
    GameWindow.setScreenLevel
  </h3>
</div>

  </div>
  <div class="body"><p>Validates and sets window's state level</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">level</span>
      <span class="dox_type">string</span>
      <span>The level of the update</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">constants.screenLevels
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setScreenLevel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">level</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">level</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.setScreenLevel: &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;level must be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">screenLevels</span><span class="p">[</span><span class="nx">level</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.setScreenLevel: unrecognized level: &#39;</span> <span class="o">+</span>
                            <span class="nx">level</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">screenState</span> <span class="o">=</span> <span class="nx">screenLevels</span><span class="p">[</span><span class="nx">level</span><span class="p">];</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.getscreenlevel">
  <h3>
    <a href="#gamewindow.getscreenlevel" class="pilcrow">&#182;</a>
    GameWindow.getScreenLevel
  </h3>
</div>

  </div>
  <div class="body"><p>Returns the current screen level</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">number</span>
      <span>The screen level</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">constants.screenLevels
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getScreenLevel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">screenState</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.getframe">
  <h3>
    <a href="#gamewindow.getframe" class="pilcrow">&#182;</a>
    GameWindow.getFrame
  </h3>
</div>

  </div>
  <div class="body"><p>Returns a reference to the HTML element of the frame of the game</p>

<p>If no reference is found, tries to retrieve and update it using the
<em>frameName</em> variable.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">HTMLIFrameElement</span>
      <span>The iframe element of the game</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.frameName
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFrame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">frameName</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">frameElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">frameName</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.getframename">
  <h3>
    <a href="#gamewindow.getframename" class="pilcrow">&#182;</a>
    GameWindow.getFrameName
  </h3>
</div>

  </div>
  <div class="body"><p>Returns the name of the frame of the game</p>

<p>If no name is found, tries to retrieve and update it using the
 <em>GameWindow.getFrame()</em>.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">string</span>
      <span>The name of the frame of the game.</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.getFrame
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFrameName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">iframe</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">frameName</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">stateLevel</span> <span class="o">===</span> <span class="nx">WIN_LOADING</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">iframe</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFrame</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">frameName</span> <span class="o">=</span> <span class="nx">iframe</span> <span class="o">?</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">id</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">frameName</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.getframewindow">
  <h3>
    <a href="#gamewindow.getframewindow" class="pilcrow">&#182;</a>
    GameWindow.getFrameWindow
  </h3>
</div>

  </div>
  <div class="body"><p>Returns a reference to the window object of the frame of the game</p>

<p>If no reference is found, tries to retrieve and update it using
<em>GameWindow.getFrame()</em>.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Window</span>
      <span>The window object of the iframe of the game</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.getFrame
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFrameWindow</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">iframe</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">frameWindow</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">stateLevel</span> <span class="o">===</span> <span class="nx">WIN_LOADING</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">iframe</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFrame</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">frameWindow</span> <span class="o">=</span> <span class="nx">iframe</span> <span class="o">?</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">frameWindow</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.getframedocument">
  <h3>
    <a href="#gamewindow.getframedocument" class="pilcrow">&#182;</a>
    GameWindow.getFrameDocument
  </h3>
</div>

  </div>
  <div class="body"><p>Returns a reference to the document object of the iframe</p>

<p>If no reference is found, tries to retrieve and update it using the
<em>GameWindow.getFrame()</em>.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Document</span>
      <span>The document object of the iframe of the game</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.getFrame</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.testDirectFrameDocumentAccess
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFrameDocument</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">iframe</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">frameDocument</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">stateLevel</span> <span class="o">===</span> <span class="nx">WIN_LOADING</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">iframe</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFrame</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">iframe</span><span class="p">)</span> <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">frameDocument</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getIFrameDocument</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-66" id="section-66">&#182;</a>
</div>
<p>Some IEs give permission denied when accessing the frame document
directly. We need to re-get it from the DOM.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">directFrameDocumentAccess</span><span class="p">)</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">frameDocument</span><span class="p">;</span>
        <span class="k">else</span> <span class="k">return</span> <span class="nx">J</span><span class="p">.</span><span class="nx">getIFrameDocument</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getFrame</span><span class="p">());</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.getframeroot">
  <h3>
    <a href="#gamewindow.getframeroot" class="pilcrow">&#182;</a>
    GameWindow.getFrameRoot
  </h3>
</div>

  </div>
  <div class="body"><p>Returns a reference to the root element for the iframe</p>

<p>If none is found tries to retrieve and update it using
<em>GameWindow.getFrame()</em>.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Element</span>
      <span>The root element in the iframe</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getFrameRoot</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">iframe</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">frameRoot</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">iframe</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFrame</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">frameRoot</span> <span class="o">=</span> <span class="nx">iframe</span> <span class="o">?</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">parentNode</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">frameRoot</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.generateframe">
  <h3>
    <a href="#gamewindow.generateframe" class="pilcrow">&#182;</a>
    GameWindow.generateFrame
  </h3>
</div>

  </div>
  <div class="body"><p>Appends a new iframe to <em>documents.body</em> and sets it as the default one</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">root</span>
      <span class="dox_type">Element</span>
      <span>Optional. The HTML element to which the iframe
  will be appended. Default: this.frameRoot or document.body</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">frameName</span>
      <span class="dox_type">string</span>
      <span>Optional. The name of the iframe. Default:
  'ng_mainframe'</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">force</span>
      <span class="dox_type">boolean</span>
      <span>Optional. Will create the frame even if an
  existing one is found. Default: FALSE</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">IFrameElement</span>
      <span>The newly created iframe</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.frameElement</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.frameWindow</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.frameDocument</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.setFrame</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.clearFrame</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.destroyFrame
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">generateFrame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">frameName</span><span class="p">,</span> <span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">iframe</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">force</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.generateFrame: a frame element is &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;already existing. Use force to regenerate.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">root</span> <span class="o">=</span> <span class="nx">root</span> <span class="o">||</span> <span class="k">this</span><span class="p">.</span><span class="nx">frameRoot</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">J</span><span class="p">.</span><span class="nx">isElement</span><span class="p">(</span><span class="nx">root</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.generateFrame: root must be &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;undefined or HTMLElement. Found: &#39;</span> <span class="o">+</span> <span class="nx">root</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">frameName</span> <span class="o">=</span> <span class="nx">frameName</span> <span class="o">||</span> <span class="s1">&#39;ng_mainframe&#39;</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">frameName</span> <span class="o">||</span> <span class="nx">frameName</span><span class="p">.</span><span class="nx">trim</span><span class="p">()</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.generateFrame: frameName must be &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;undefined or a non-empty string. Found: &#39;</span> <span class="o">+</span>
                            <span class="nx">frameName</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">frameName</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.generateFrame: frameName is not &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;unique in DOM: &#39;</span> <span class="o">+</span> <span class="nx">frameName</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">iframe</span> <span class="o">=</span> <span class="nx">W</span><span class="p">.</span><span class="nx">addIFrame</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">frameName</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69">&#182;</a>
</div>
<p>Method .replace does not add the uri to the history.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="s1">&#39;about:blank&#39;</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70">&#182;</a>
</div>
<p>For IE8.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">iframe</span><span class="p">.</span><span class="nx">frameBorder</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">setFrame</span><span class="p">(</span><span class="nx">iframe</span><span class="p">,</span> <span class="nx">frameName</span><span class="p">,</span> <span class="nx">root</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">)</span> <span class="nx">adaptFrame2HeaderPosition</span><span class="p">(</span><span class="k">this</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-71" id="section-71">&#182;</a>
</div>
<p>Emit event.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">ng</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;FRAME_GENERATED&#39;</span><span class="p">,</span> <span class="nx">iframe</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">iframe</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.generateinfopanel">
  <h3>
    <a href="#gamewindow.generateinfopanel" class="pilcrow">&#182;</a>
    GameWindow.generateInfoPanel
  </h3>
</div>

  </div>
  <div class="body"><p>Appends a configurable div element at to "top" of the page</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">root</span>
      <span class="dox_type">Element</span>
      <span>Optional. The HTML element to which the info
  panel will be appended. Default:

<ul>
<li>above the main frame, or</li>
<li>below the header, or</li>
<li>inside <em>documents.body</em>.</li>
</ul></span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">frameName</span>
      <span class="dox_type">string</span>
      <span>Optional. The name of the iframe. Default:
  'ng_mainframe'</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">force</span>
      <span class="dox_type">boolean</span>
      <span>Optional. Will create the frame even if an
  existing one is found. Default: FALSE</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">InfoPanel</span>
      <span>A reference to the InfoPanel object</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.infoPanel
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">generateInfoPanel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">options</span><span class="p">,</span> <span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">infoPanelDiv</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">infoPanel</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.generateInfoPanel: info panel is &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;already existing. Use force to regenerate.&#39;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">infoPanel</span><span class="p">.</span><span class="nx">destroy</span><span class="p">();</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">infoPanel</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">infoPanel</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">node</span><span class="p">.</span><span class="nx">InfoPanel</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
        <span class="nx">infoPanelDiv</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">infoPanel</span><span class="p">.</span><span class="nx">infoPanelDiv</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">J</span><span class="p">.</span><span class="nx">isElement</span><span class="p">(</span><span class="nx">root</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.generateInfoPanel: root must be &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;undefined or HTMLElement. Found: &#39;</span> <span class="o">+</span> <span class="nx">root</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">root</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">infoPanelDiv</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">)</span> <span class="p">{</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">infoPanelDiv</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">)</span> <span class="p">{</span>
           <span class="nx">J</span><span class="p">.</span><span class="nx">insertAfter</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">,</span> <span class="nx">infoPanelDiv</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">infoPanelDiv</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-73" id="section-73">&#182;</a>
</div>
<p>Emit event.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">ng</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;INFOPANEL_GENERATED&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">infoPanel</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">infoPanel</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.setframe">
  <h3>
    <a href="#gamewindow.setframe" class="pilcrow">&#182;</a>
    GameWindow.setFrame
  </h3>
</div>

  </div>
  <div class="body"><p>Sets the new default frame and update other references</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">iframe</span>
      <span class="dox_type">IFrameElement</span>
      <span>The new default frame</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">frameName</span>
      <span class="dox_type">string</span>
      <span>The name of the iframe</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">root</span>
      <span class="dox_type">Element</span>
      <span>The HTML element to which the iframe is appended</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">IFrameElement</span>
      <span>The new default iframe</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.generateFrame
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setFrame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">iframe</span><span class="p">,</span> <span class="nx">iframeName</span><span class="p">,</span> <span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">J</span><span class="p">.</span><span class="nx">isElement</span><span class="p">(</span><span class="nx">iframe</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.setFrame: iframe must be HTMLElement.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">iframeName</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.setFrame: iframeName must be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">J</span><span class="p">.</span><span class="nx">isElement</span><span class="p">(</span><span class="nx">root</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.setFrame: invalid root element.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">frameRoot</span> <span class="o">=</span> <span class="nx">root</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">frameName</span> <span class="o">=</span> <span class="nx">iframeName</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">frameElement</span> <span class="o">=</span> <span class="nx">iframe</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">frameWindow</span> <span class="o">=</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">frameDocument</span> <span class="o">=</span> <span class="nx">W</span><span class="p">.</span><span class="nx">getIFrameDocument</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">iframe</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.destroyframe">
  <h3>
    <a href="#gamewindow.destroyframe" class="pilcrow">&#182;</a>
    GameWindow.destroyFrame
  </h3>
</div>

  </div>
  <div class="body"><p>Clears the content of the frame and removes the element from the page</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.clearFrame
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">destroyFrame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">clearFrame</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">frameRoot</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">frameRoot</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">frameElement</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">frameWindow</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">frameDocument</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">frameRoot</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.clearframe">
  <h3>
    <a href="#gamewindow.clearframe" class="pilcrow">&#182;</a>
    GameWindow.clearFrame
  </h3>
</div>

  </div>
  <div class="body"><p>Clears the content of the frame</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clearFrame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">iframe</span><span class="p">,</span> <span class="nx">frameName</span><span class="p">,</span> <span class="nx">frameDocument</span><span class="p">;</span>
        <span class="nx">iframe</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFrame</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">iframe</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.clearFrame: cannot detect frame.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">frameName</span> <span class="o">=</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">name</span> <span class="o">||</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
        <span class="nx">iframe</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-77" id="section-77">&#182;</a>
</div>
<p>Method .replace does not add the uri to the history.
iframe.contentWindow.location.replace('about:blank');</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">frameDocument</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFrameDocument</span><span class="p">();</span>
        <span class="nx">frameDocument</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">directFrameDocumentAccess</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">frameDocument</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">J</span><span class="p">.</span><span class="nx">removeChildrenFromNode</span><span class="p">(</span><span class="nx">frameDocument</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-78" id="section-78">&#182;</a>
</div>
<p>TODO: cleanup refactor.
        try {
            this.getFrameDocument().documentElement.innerHTML = '';
        }
        catch(e) {
            // IE &lt; 10 gives 'Permission Denied' if trying to access
            // the iframeDoc from the context of the function above.
            // We need to re-get it from the DOM.
            if (J.getIFrameDocument(iframe).documentElement) {
                J.removeChildrenFromNode(
                    J.getIFrameDocument(iframe).documentElement);
            }
        }</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">frameElement</span> <span class="o">=</span> <span class="nx">iframe</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">frameWindow</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">frames</span><span class="p">[</span><span class="nx">frameName</span><span class="p">];</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">frameDocument</span> <span class="o">=</span> <span class="nx">W</span><span class="p">.</span><span class="nx">getIFrameDocument</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.generateheader">
  <h3>
    <a href="#gamewindow.generateheader" class="pilcrow">&#182;</a>
    GameWindow.generateHeader
  </h3>
</div>

  </div>
  <div class="body"><p>Adds a a div element and sets it as the header of the page</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">root</span>
      <span class="dox_type">Element</span>
      <span>Optional. The HTML element to which the header
  will be appended. Default: <em>document.body</em> or
  <em>document.lastElementChild</em></span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">headerName</span>
      <span class="dox_type">string</span>
      <span>Optional. The name (id) of the header.
  Default: 'ng_header'</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">force</span>
      <span class="dox_type">boolean</span>
      <span>Optional. Will create the header even if an
  existing one is found. Default: FALSE</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Element</span>
      <span>The header element</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">generateHeader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">headerName</span><span class="p">,</span> <span class="nx">force</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">header</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">force</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.generateHeader: a header element is &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;already existing. Use force to regenerate.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">root</span> <span class="o">=</span> <span class="nx">root</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">body</span> <span class="o">||</span> <span class="nb">document</span><span class="p">.</span><span class="nx">lastElementChild</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">J</span><span class="p">.</span><span class="nx">isElement</span><span class="p">(</span><span class="nx">root</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.generateHeader: root must be &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;undefined or HTMLElement. Found: &#39;</span> <span class="o">+</span> <span class="nx">root</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">headerName</span> <span class="o">=</span> <span class="nx">headerName</span> <span class="o">||</span> <span class="s1">&#39;ng_header&#39;</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">headerName</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.generateHeader: headerName must be &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;string. Found: &#39;</span> <span class="o">+</span> <span class="nx">headerName</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">headerName</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.generateHeader: headerName is not &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;unique in DOM: &#39;</span> <span class="o">+</span> <span class="nx">headerName</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">header</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">addElement</span><span class="p">(</span><span class="s1">&#39;div&#39;</span><span class="p">,</span> <span class="nx">root</span><span class="p">,</span> <span class="nx">headerName</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-80" id="section-80">&#182;</a>
</div>
<p>If generateHeader is called after generateFrame, and the default
header position is not bottom, we need to move the header in front.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">frameElement</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">defaultHeaderPosition</span> <span class="o">!==</span> <span class="s1">&#39;bottom&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">getFrameRoot</span><span class="p">().</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">header</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">setHeader</span><span class="p">(</span><span class="nx">header</span><span class="p">,</span> <span class="nx">headerName</span><span class="p">,</span> <span class="nx">root</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">setHeaderPosition</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">defaultHeaderPosition</span><span class="p">);</span>

        <span class="k">return</span> <span class="nx">header</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.setheaderposition">
  <h3>
    <a href="#gamewindow.setheaderposition" class="pilcrow">&#182;</a>
    GameWindow.setHeaderPosition
  </h3>
</div>

  </div>
  <div class="body"><p>Sets the header's position on the screen</p>

<p>Positioning of the frame element is also affected, if existing, or if
added later.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">position</span>
      <span class="dox_type">string</span>
      <span>New position, one of
  'top', 'bottom', 'left', 'right'</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.generateHeader</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.headerPosition</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.defaultHeaderPosition</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">adaptFrame2HeaderPosition
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setHeaderPosition</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">position</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">validPositions</span><span class="p">,</span> <span class="nx">pos</span><span class="p">,</span> <span class="nx">oldPos</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">position</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.setHeaderPosition: position &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;must be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">pos</span> <span class="o">=</span> <span class="nx">position</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-82" id="section-82">&#182;</a>
</div>
<p>Do something only if there is a change in the position.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">headerPosition</span> <span class="o">===</span> <span class="nx">pos</span><span class="p">)</span> <span class="k">return</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-83" id="section-83">&#182;</a>
</div>
<p>Map: position - css class.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">validPositions</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s1">&#39;top&#39;</span><span class="o">:</span> <span class="s1">&#39;ng_header_position-horizontal-t&#39;</span><span class="p">,</span>
            <span class="s1">&#39;bottom&#39;</span><span class="o">:</span> <span class="s1">&#39;ng_header_position-horizontal-b&#39;</span><span class="p">,</span>
            <span class="s1">&#39;right&#39;</span><span class="o">:</span> <span class="s1">&#39;ng_header_position-vertical-r&#39;</span><span class="p">,</span>
            <span class="s1">&#39;left&#39;</span><span class="o">:</span> <span class="s1">&#39;ng_header_position-vertical-l&#39;</span>
        <span class="p">};</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">validPositions</span><span class="p">[</span><span class="nx">pos</span><span class="p">])</span> <span class="p">{</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">err</span><span class="p">(</span><span class="s1">&#39;GameWindow.setHeaderPosition: invalid header &#39;</span> <span class="o">+</span>
                     <span class="s1">&#39;position: &#39;</span> <span class="o">+</span> <span class="nx">pos</span>  <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.setHeaderPosition: headerElement &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;not found.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">W</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">,</span> <span class="s1">&#39;ng_header_position-[a-z-]*&#39;</span><span class="p">);</span>
        <span class="nx">W</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">,</span> <span class="nx">validPositions</span><span class="p">[</span><span class="nx">pos</span><span class="p">]);</span>

        <span class="nx">oldPos</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">headerPosition</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-84" id="section-84">&#182;</a>
</div>
<p>Store the new position in a reference variable
<strong>before</strong> adaptFrame2HeaderPosition is called</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">headerPosition</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">adaptFrame2HeaderPosition</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">oldPos</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.setheader">
  <h3>
    <a href="#gamewindow.setheader" class="pilcrow">&#182;</a>
    GameWindow.setHeader
  </h3>
</div>

  </div>
  <div class="body"><p>Sets the new header element and update related references</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">header</span>
      <span class="dox_type">Element</span>
      <span>The new header</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">headerName</span>
      <span class="dox_type">string</span>
      <span>The name of the header</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">root</span>
      <span class="dox_type">Element</span>
      <span>The HTML element to which the header is appended</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Element</span>
      <span>The new header</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.generateHeader
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setHeader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">header</span><span class="p">,</span> <span class="nx">headerName</span><span class="p">,</span> <span class="nx">root</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">J</span><span class="p">.</span><span class="nx">isElement</span><span class="p">(</span><span class="nx">header</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span>
                <span class="s1">&#39;GameWindow.setHeader: header must be HTMLElement.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">headerName</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.setHeader: headerName must be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">J</span><span class="p">.</span><span class="nx">isElement</span><span class="p">(</span><span class="nx">root</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.setHeader: invalid root element.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">headerElement</span> <span class="o">=</span> <span class="nx">header</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">headerName</span> <span class="o">=</span> <span class="nx">headerName</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">headerRoot</span> <span class="o">=</span> <span class="nx">root</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-86" id="section-86">&#182;</a>
</div>
<p>Emit event.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">ng</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;HEADER_GENERATED&#39;</span><span class="p">,</span> <span class="nx">header</span><span class="p">);</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.getheader">
  <h3>
    <a href="#gamewindow.getheader" class="pilcrow">&#182;</a>
    GameWindow.getHeader
  </h3>
</div>

  </div>
  <div class="body"><p>Returns a reference to the header element, if defined</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Element</span>
      <span>The header element</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getHeader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">headerElement</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">headerName</span> <span class="o">?</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">headerName</span><span class="p">)</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.getheadername">
  <h3>
    <a href="#gamewindow.getheadername" class="pilcrow">&#182;</a>
    GameWindow.getHeaderName
  </h3>
</div>

  </div>
  <div class="body"><p>Returns the name (id) of the header element</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">string</span>
      <span>The name (id) of the header</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getHeaderName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">header</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">headerName</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">header</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getHeader</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">headerName</span> <span class="o">=</span> <span class="nx">header</span> <span class="o">?</span> <span class="nx">header</span><span class="p">.</span><span class="nx">id</span> <span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">headerName</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.getheaderroot">
  <h3>
    <a href="#gamewindow.getheaderroot" class="pilcrow">&#182;</a>
    GameWindow.getHeaderRoot
  </h3>
</div>

  </div>
  <div class="body"><p>Returns the HTML element to which the header is appended</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">HTMLElement</span>
      <span>The HTML element to which the header is appended</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getHeaderRoot</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">header</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">headerRoot</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">header</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getHeader</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">headerRoot</span> <span class="o">=</span> <span class="nx">header</span> <span class="o">?</span> <span class="nx">header</span><span class="p">.</span><span class="nx">parentNode</span><span class="o">:</span> <span class="kc">null</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">headerRoot</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.destroyheader">
  <h3>
    <a href="#gamewindow.destroyheader" class="pilcrow">&#182;</a>
    GameWindow.destroyHeader
  </h3>
</div>

  </div>
  <div class="body"><p>Clears the content of the header and removes the element from the page</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.clearHeader
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">destroyHeader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">clearHeader</span><span class="p">();</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">headerRoot</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">headerElement</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">headerName</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">headerRoot</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">headerPosition</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.clearheader">
  <h3>
    <a href="#gamewindow.clearheader" class="pilcrow">&#182;</a>
    GameWindow.clearHeader
  </h3>
</div>

  </div>
  <div class="body"><p>Clears the content of the header</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clearHeader</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">header</span><span class="p">;</span>
        <span class="nx">header</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getHeader</span><span class="p">();</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">header</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.clearHeader: cannot detect header.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.initlibs">
  <h3>
    <a href="#gamewindow.initlibs" class="pilcrow">&#182;</a>
    GameWindow.initLibs
  </h3>
</div>

  </div>
  <div class="body"><p>Specifies the libraries to be loaded automatically in the iframe</p>

<p>Multiple calls to <em>initLibs</em> append the new libs to the list.
Deletion must be done manually.</p>

<p>This method must be called before any call to GameWindow.loadFrame.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">globalLibs</span>
      <span class="dox_type">array</span>
      <span>Array of strings describing absolute library
  paths that should be loaded in every iframe</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">frameLibs</span>
      <span class="dox_type">object</span>
      <span>Map from URIs to string arrays (as above)
  specifying libraries that should only be loaded for iframes displaying
  the given URI. This must not contain any elements that are also in
  globalLibs.</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">initLibs</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">globalLibs</span><span class="p">,</span> <span class="nx">frameLibs</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">globalLibs</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">J</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">globalLibs</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.initLibs: globalLibs must be &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;array or undefined.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">frameLibs</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">frameLibs</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.initLibs: frameLibs must be &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;object or undefined.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">globalLibs</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="nx">frameLibs</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.initLibs: frameLibs and frameLibs &#39;</span> <span class="o">+</span>
                            <span class="s1">&#39;cannot be both undefined.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">globalLibs</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">globalLibs</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span><span class="nx">globalLibs</span> <span class="o">||</span> <span class="p">[]);</span>
        <span class="nx">J</span><span class="p">.</span><span class="nx">mixin</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">frameLibs</span><span class="p">,</span> <span class="nx">frameLibs</span><span class="p">);</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.precachetest">
  <h3>
    <a href="#gamewindow.precachetest" class="pilcrow">&#182;</a>
    GameWindow.preCacheTest
  </h3>
</div>

  </div>
  <div class="body"><p>Tests whether preChace is supported by the browser</p>

<p>Results are stored in <em>GameWindow.cacheSupported</em>.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">cb</span>
      <span class="dox_type">function</span>
      <span>Optional. The function to call once the test if
  finished. It will be called regardless of success or failure.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uri</span>
      <span class="dox_type">string</span>
      <span>Optional. The URI to test. Default:
  '/pages/testpage.htm'</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.cacheSupported
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">preCacheTest</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">cb</span><span class="p">,</span> <span class="nx">uri</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">iframe</span><span class="p">,</span> <span class="nx">iframeName</span><span class="p">;</span>
        <span class="nx">uri</span> <span class="o">=</span> <span class="nx">uri</span> <span class="o">||</span> <span class="s1">&#39;/pages/testpage.htm&#39;</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">uri</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.precacheTest: uri must string or &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;undefined.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;iframe&#39;</span><span class="p">);</span>
        <span class="nx">iframe</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
        <span class="nx">iframeName</span> <span class="o">=</span> <span class="s1">&#39;preCacheTest&#39;</span><span class="p">;</span>
        <span class="nx">iframe</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">iframeName</span><span class="p">;</span>
        <span class="nx">iframe</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">iframeName</span><span class="p">;</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
        <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
        <span class="nx">onLoad</span><span class="p">(</span><span class="nx">iframe</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-94" id="section-94">&#182;</a>
</div>
<p>var iframe, docElem;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">try</span> <span class="p">{</span>
                <span class="nx">W</span><span class="p">.</span><span class="nx">getIFrameDocument</span><span class="p">(</span><span class="nx">iframe</span><span class="p">).</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;a&#39;</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-95" id="section-95">&#182;</a>
</div>
<p>This passes in IE8, but the rest of the caching doesn't.
We want this test to fail in IE8.
iframe = document.getElementById(iframeName);
docElem = W.getIFrameDocument(iframe);
docElem.innerHTML = 'a';</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="nx">W</span><span class="p">.</span><span class="nx">cacheSupported</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">W</span><span class="p">.</span><span class="nx">cacheSupported</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">cb</span><span class="p">)</span> <span class="nx">cb</span><span class="p">();</span>
        <span class="p">});</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.precache">
  <h3>
    <a href="#gamewindow.precache" class="pilcrow">&#182;</a>
    GameWindow.preCache
  </h3>
</div>

  </div>
  <div class="body"><p>Loads the HTML content of the given URI(s) into the cache</p>

<p>If caching is not supported by the browser, the callback will be
executed anyway.</p>

<p>All uri to precache are parsed with <code>GameWindow.processUri</code> before
being loaded.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uris</span>
      <span class="dox_type">string</span>
      <span class="dox_type">array</span>
      <span>The URI(s) to cache</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">callback</span>
      <span class="dox_type">function</span>
      <span>Optional. The function to call once the
  caching is done</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.cacheSupported</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.preCacheTest</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.processUri
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">preCache</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uris</span><span class="p">,</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">loadedCount</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">currentUri</span><span class="p">,</span> <span class="nx">uriIdx</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">iframe</span><span class="p">,</span> <span class="nx">iframeName</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">uris</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">uris</span> <span class="o">=</span> <span class="p">[</span> <span class="nx">uris</span> <span class="p">];</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">J</span><span class="p">.</span><span class="nx">isArray</span><span class="p">(</span><span class="nx">uris</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.preCache: uris must be string &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;or array.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;function&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">callback</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.preCache: callback must be &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;function or undefined.&#39;</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-97" id="section-97">&#182;</a>
</div>
<p>Don't preload if an empty array is passed.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">uris</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="nx">callback</span><span class="p">();</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-98" id="section-98">&#182;</a>
</div>
<p>Before proceeding with caching, check if caching is supported.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cacheSupported</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">preCacheTest</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">preCache</span><span class="p">(</span><span class="nx">uris</span><span class="p">,</span> <span class="nx">callback</span><span class="p">);</span>
            <span class="p">});</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cacheSupported</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">warn</span><span class="p">(</span><span class="s1">&#39;GameWindow.preCache: caching is not supported by &#39;</span> <span class="o">+</span>
                      <span class="s1">&#39;your browser.&#39;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="nx">callback</span><span class="p">();</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-99" id="section-99">&#182;</a>
</div>
<p>Keep count of loaded URIs:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">loadedCount</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">uriIdx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">uriIdx</span> <span class="o">&lt;</span> <span class="nx">uris</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">uriIdx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">currentUri</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">processUri</span><span class="p">(</span><span class="nx">uris</span><span class="p">[</span><span class="nx">uriIdx</span><span class="p">]);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-100" id="section-100">&#182;</a>
</div>
<p>Create an invisible internal frame for the current URI:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;iframe&#39;</span><span class="p">);</span>
            <span class="nx">iframe</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s1">&#39;none&#39;</span><span class="p">;</span>
            <span class="nx">iframeName</span> <span class="o">=</span> <span class="s1">&#39;tmp_iframe_&#39;</span> <span class="o">+</span> <span class="nx">uriIdx</span><span class="p">;</span>
            <span class="nx">iframe</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">iframeName</span><span class="p">;</span>
            <span class="nx">iframe</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">iframeName</span><span class="p">;</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>

            <span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="nx">thisIframe</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-101" id="section-101">&#182;</a>
</div>
<p>Register the onLoad handler:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="nx">onLoad</span><span class="p">(</span><span class="nx">thisIframe</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">frameDocument</span><span class="p">,</span> <span class="nx">frameDocumentElement</span><span class="p">;</span>

                    <span class="nx">frameDocument</span> <span class="o">=</span> <span class="nx">W</span><span class="p">.</span><span class="nx">getIFrameDocument</span><span class="p">(</span><span class="nx">thisIframe</span><span class="p">);</span>
                    <span class="nx">frameDocumentElement</span> <span class="o">=</span> <span class="nx">frameDocument</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-102" id="section-102">&#182;</a>
</div>
<p>Store the contents in the cache:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                    <span class="nx">that</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">uri</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                        <span class="nx">contents</span><span class="o">:</span> <span class="nx">frameDocumentElement</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">,</span>
                        <span class="nx">cacheOnClose</span><span class="o">:</span> <span class="kc">false</span>
                    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-103" id="section-103">&#182;</a>
</div>
<p>Remove the internal frame:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">thisIframe</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-104" id="section-104">&#182;</a>
</div>
<p>Increment loaded URIs counter:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                    <span class="nx">loadedCount</span><span class="o">++</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="nx">loadedCount</span> <span class="o">&gt;=</span> <span class="nx">uris</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-105" id="section-105">&#182;</a>
</div>
<p>All requested URIs have been loaded at this point.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                        <span class="k">if</span> <span class="p">(</span><span class="nx">callback</span><span class="p">)</span> <span class="nx">callback</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">});</span>
            <span class="p">})(</span><span class="nx">currentUri</span><span class="p">,</span> <span class="nx">iframe</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-106" id="section-106">&#182;</a>
</div>
<p>Start loading the page:
Method .replace does not add the uri to the history.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nb">window</span><span class="p">.</span><span class="nx">frames</span><span class="p">[</span><span class="nx">iframeName</span><span class="p">].</span><span class="nx">location</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">currentUri</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.clearcache">
  <h3>
    <a href="#gamewindow.clearcache" class="pilcrow">&#182;</a>
    GameWindow.clearCache
  </h3>
</div>

  </div>
  <div class="body"><p>Empties the cache</p>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clearCache</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">cache</span> <span class="o">=</span> <span class="p">{};</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.getelementbyid">
  <h3>
    <a href="#gamewindow.getelementbyid" class="pilcrow">&#182;</a>
    GameWindow.getElementById
  </h3>
</div>

  </div>
  <div class="body"><p>Returns the element with the given id</p>

<p>Looks first into the iframe and then into the rest of the page.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">id</span>
      <span class="dox_type">string</span>
      <span>The id of the element</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">Element</span>
      <span class="dox_type">null</span>
      <span>The element in the page, or null if none is found</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.getElementsByTagName
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getElementById</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">id</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">el</span><span class="p">,</span> <span class="nx">frameDocument</span><span class="p">;</span>

        <span class="nx">frameDocument</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFrameDocument</span><span class="p">();</span>
        <span class="nx">el</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">frameDocument</span> <span class="o">&amp;&amp;</span> <span class="nx">frameDocument</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">el</span> <span class="o">=</span> <span class="nx">frameDocument</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">el</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">el</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.getelementsbytagname">
  <h3>
    <a href="#gamewindow.getelementsbytagname" class="pilcrow">&#182;</a>
    GameWindow.getElementsByTagName
  </h3>
</div>

  </div>
  <div class="body"><p>Returns a list of elements with the given tag name</p>

<p>If set, it will look up in iframe, otherwsie into the rest of the page.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">tag</span>
      <span class="dox_type">string</span>
      <span>The tag of the elements</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">array</span>
      <span class="dox_type">null</span>
      <span>The elements in the page, or null if none is found</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.getElementById</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.frameDocument
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getElementsByTagName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">frameDocument</span><span class="p">;</span>
        <span class="nx">frameDocument</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFrameDocument</span><span class="p">();</span>
        <span class="k">return</span> <span class="nx">frameDocument</span> <span class="o">?</span> <span class="nx">frameDocument</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">tag</span><span class="p">)</span> <span class="o">:</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="nx">tag</span><span class="p">);</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.getelementsbyclassname">
  <h3>
    <a href="#gamewindow.getelementsbyclassname" class="pilcrow">&#182;</a>
    GameWindow.getElementsByClassName
  </h3>
</div>

  </div>
  <div class="body"><p>Returns a list of elements with given class name</p>

<p>If set, it will look up in iframe, otherwsie into the rest of the page.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">className</span>
      <span class="dox_type">string</span>
      <span>The requested className</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">tag</span>
      <span class="dox_type">string</span>
      <span>Optional. If set only elements with
  the specified tag name will be searched</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">array</span>
      <span>Array of elements with the requested class name</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.getElementByTagName</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.frameDocument
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">getElementsByClassName</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">className</span><span class="p">,</span> <span class="nx">tag</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">doc</span><span class="p">;</span>
        <span class="nx">doc</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFrameDocument</span><span class="p">()</span> <span class="o">||</span> <span class="nb">document</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">J</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="nx">doc</span><span class="p">,</span> <span class="nx">className</span><span class="p">,</span> <span class="nx">tag</span><span class="p">);</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.loadframe">
  <h3>
    <a href="#gamewindow.loadframe" class="pilcrow">&#182;</a>
    GameWindow.loadFrame
  </h3>
</div>

  </div>
  <div class="body"><p>Loads content from an uri (remote or local) into the iframe,
and after it is loaded executes the callback function</p>

<p>The third parameter is an options object with the following fields
(any fields left out assume the default setting):</p>

<ul>
<li>cache (object): Caching options. Fields:
<ul><li>loadMode (string):
 'cache' (default; get the page from cache if possible),
 'reload' (reload page without the cache)</li>
<li>storeMode (string):
 'off' (default; don't cache page),
 'onLoad' (cache given page after it is loaded),
 'onClose' (cache given page after it is replaced by a new page)</li></ul></li>
</ul>

<p>Warning: Security policies may block this method if the content is
coming from another domain.
Notice: If called multiple times within the same stage/step, it will
cause the <code>VisualTimer</code> widget to reload the timer.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uri</span>
      <span class="dox_type">string</span>
      <span>The uri to load</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">func</span>
      <span class="dox_type">function</span>
      <span>Optional. The function to call once the DOM is
  ready</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">opts</span>
      <span class="dox_type">object</span>
      <span>Optional. The options object</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.uriPrefix</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.uriChannel
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">loadFrame</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">that</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">loadCache</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">storeCacheNow</span><span class="p">,</span> <span class="nx">storeCacheLater</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">autoParse</span><span class="p">,</span> <span class="nx">autoParsePrefix</span><span class="p">,</span> <span class="nx">autoParseMod</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">iframe</span><span class="p">,</span> <span class="nx">iframeName</span><span class="p">,</span> <span class="nx">iframeDocument</span><span class="p">,</span> <span class="nx">iframeWindow</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">frameDocumentElement</span><span class="p">,</span> <span class="nx">frameReady</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">lastURI</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">uri</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.loadFrame: uri must be string.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">func</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;function&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.loadFrame: func must be function &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;or undefined.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">opts</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.loadFrame: opts must be object &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;or undefined.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="nx">opts</span> <span class="o">=</span> <span class="nx">opts</span> <span class="o">||</span> <span class="p">{};</span>

        <span class="nx">iframe</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">getFrame</span><span class="p">();</span>
        <span class="nx">iframeName</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">frameName</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">iframe</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.loadFrame: no frame found.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">iframeName</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.loadFrame: frame has no name.&#39;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">setStateLevel</span><span class="p">(</span><span class="s1">&#39;LOADING&#39;</span><span class="p">);</span>
        <span class="nx">that</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-112" id="section-112">&#182;</a>
</div>
<p>Save ref to iframe window for later.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">iframeWindow</span> <span class="o">=</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-113" id="section-113">&#182;</a>
</div>
<p>Query readiness (so we know whether onload is going to be called):</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">iframeDocument</span> <span class="o">=</span> <span class="nx">W</span><span class="p">.</span><span class="nx">getIFrameDocument</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
        <span class="nx">frameReady</span> <span class="o">=</span> <span class="nx">iframeDocument</span><span class="p">.</span><span class="nx">readyState</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-114" id="section-114">&#182;</a>
</div>
<p>...reduce it to a boolean:
frameReady = frameReady === 'interactive'||frameReady === 'complete';</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">frameReady</span> <span class="o">=</span> <span class="nx">frameReady</span> <span class="o">===</span> <span class="s1">&#39;complete&#39;</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-115" id="section-115">&#182;</a>
</div>
<p>Begin loadFrame caching section.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-116" id="section-116">&#182;</a>
</div>
<p>Default options.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">loadCache</span> <span class="o">=</span> <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">cacheDefaults</span><span class="p">.</span><span class="nx">loadCache</span><span class="p">;</span>
        <span class="nx">storeCacheNow</span> <span class="o">=</span> <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">cacheDefaults</span><span class="p">.</span><span class="nx">storeCacheNow</span><span class="p">;</span>
        <span class="nx">storeCacheLater</span> <span class="o">=</span> <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">defaults</span><span class="p">.</span><span class="nx">cacheDefaults</span><span class="p">.</span><span class="nx">storeCacheLater</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-117" id="section-117">&#182;</a>
</div>
<p>Caching options.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">loadMode</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">loadMode</span> <span class="o">===</span> <span class="s1">&#39;reload&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">loadCache</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">loadMode</span> <span class="o">===</span> <span class="s1">&#39;cache&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">loadCache</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.loadFrame: unkown cache &#39;</span> <span class="o">+</span>
                                    <span class="s1">&#39;load mode: &#39;</span> <span class="o">+</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">loadMode</span> <span class="o">+</span> <span class="s1">&#39;.&#39;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">storeMode</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">storeMode</span> <span class="o">===</span> <span class="s1">&#39;off&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">storeCacheNow</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="nx">storeCacheLater</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">storeMode</span> <span class="o">===</span> <span class="s1">&#39;onLoad&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">storeCacheNow</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                    <span class="nx">storeCacheLater</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">storeMode</span> <span class="o">===</span> <span class="s1">&#39;onClose&#39;</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">storeCacheNow</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
                    <span class="nx">storeCacheLater</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;GameWindow.loadFrame: unkown cache &#39;</span> <span class="o">+</span>
                                    <span class="s1">&#39;store mode: &#39;</span> <span class="o">+</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">storeMode</span> <span class="o">+</span>
                                    <span class="s1">&#39;.&#39;</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">autoParse</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;object&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">autoParse</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.loadFrame: opts.autoParse &#39;</span> <span class="o">+</span>
                                    <span class="s1">&#39;must be object or undefined.&#39;</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">autoParsePrefix</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">autoParsePrefix</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.loadFrame: opts.&#39;</span> <span class="o">+</span>
                                        <span class="s1">&#39;autoParsePrefix must be string &#39;</span> <span class="o">+</span>
                                        <span class="s1">&#39;or undefined.&#39;</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">autoParsePrefix</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">autoParsePrefix</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">autoParseMod</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">autoParseMod</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.loadFrame: opts.&#39;</span> <span class="o">+</span>
                                        <span class="s1">&#39;autoParseMod must be string &#39;</span> <span class="o">+</span>
                                        <span class="s1">&#39;or undefined.&#39;</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nx">autoParseMod</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">autoParseMod</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="nx">autoParse</span> <span class="o">=</span> <span class="nx">opts</span><span class="p">.</span><span class="nx">autoParse</span><span class="p">;</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-118" id="section-118">&#182;</a>
</div>
<p>Store unprocessed uri parameter.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">unprocessedUri</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cacheSupported</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">preCacheTest</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">loadFrame</span><span class="p">(</span><span class="nx">uri</span><span class="p">,</span> <span class="nx">func</span><span class="p">,</span> <span class="nx">opts</span><span class="p">);</span>
            <span class="p">});</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-119" id="section-119">&#182;</a>
</div>
<p>Adapt the uri if necessary. Important! Must follow
the assignment to unprocessedUri AND preCacheTest.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">uri</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">processUri</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cacheSupported</span> <span class="o">===</span> <span class="kc">false</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">storeCacheNow</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="nx">storeCacheLater</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="nx">loadCache</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-120" id="section-120">&#182;</a>
</div>
<p>If the last frame requested to be cached on closing, do that:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">lastURI</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">currentURIs</span><span class="p">[</span><span class="nx">iframeName</span><span class="p">];</span>

            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">lastURI</span><span class="p">)</span> <span class="o">&amp;&amp;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">lastURI</span><span class="p">].</span><span class="nx">cacheOnClose</span><span class="p">)</span> <span class="p">{</span>

                <span class="nx">frameDocumentElement</span> <span class="o">=</span> <span class="nx">iframeDocument</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">;</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">lastURI</span><span class="p">].</span><span class="nx">contents</span> <span class="o">=</span> <span class="nx">frameDocumentElement</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
            <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-121" id="section-121">&#182;</a>
</div>
<p>Create entry for this URI in cache object
and store cacheOnClose flag:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">uri</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">uri</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="nx">contents</span><span class="o">:</span> <span class="kc">null</span><span class="p">,</span> <span class="nx">cacheOnClose</span><span class="o">:</span> <span class="kc">false</span> <span class="p">};</span>
            <span class="p">}</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">uri</span><span class="p">].</span><span class="nx">cacheOnClose</span> <span class="o">=</span> <span class="nx">storeCacheLater</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-122" id="section-122">&#182;</a>
</div>
<p>Disable loadCache if contents aren't cached:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">uri</span><span class="p">].</span><span class="nx">contents</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="nx">loadCache</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-123" id="section-123">&#182;</a>
</div>
<p>End loadFrame caching section.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-124" id="section-124">&#182;</a>
</div>
<p>Update frame's currently showing URI:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">currentURIs</span><span class="p">[</span><span class="nx">iframeName</span><span class="p">]</span> <span class="o">=</span> <span class="nx">uri</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-125" id="section-125">&#182;</a>
</div>
<p>Keep track of nested call to loadFrame.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">updateAreLoading</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-126" id="section-126">&#182;</a>
</div>
<p>Add the onLoad event listener:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">loadCache</span> <span class="o">||</span> <span class="o">!</span><span class="nx">frameReady</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">onLoad</span><span class="p">(</span><span class="nx">iframe</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-127" id="section-127">&#182;</a>
</div>
<p>Check if direct access to the content of the frame is
allowed. Usually IEs do not allow this. Notice, this
is different from preCaching, and that a newly
generated frame (about:blank) will always be accessible.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">directFrameDocumentAccess</span> <span class="o">===</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">testDirectFrameDocumentAccess</span><span class="p">(</span><span class="nx">that</span><span class="p">);</span>
                <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-128" id="section-128">&#182;</a>
</div>
<p>Handles caching.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="nx">handleFrameLoad</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">uri</span><span class="p">,</span> <span class="nx">iframe</span><span class="p">,</span> <span class="nx">iframeName</span><span class="p">,</span> <span class="nx">loadCache</span><span class="p">,</span>
                                <span class="nx">storeCacheNow</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-129" id="section-129">&#182;</a>
</div>
<p>Executes callback, autoParses,
and updates GameWindow state.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                                    <span class="nx">that</span><span class="p">.</span><span class="nx">updateLoadFrameState</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span>
                                                              <span class="nx">autoParse</span><span class="p">,</span>
                                                              <span class="nx">autoParseMod</span><span class="p">,</span>
                                                              <span class="nx">autoParsePrefix</span><span class="p">);</span>
                                <span class="p">});</span>
            <span class="p">});</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-130" id="section-130">&#182;</a>
</div>
<p>Cache lookup:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">loadCache</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-131" id="section-131">&#182;</a>
</div>
<p>Load iframe contents at this point only if the iframe is already
"ready" (see definition of frameReady), otherwise the contents
would be cleared once the iframe becomes ready. In that case,
iframe.onload handles the filling of the contents.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">frameReady</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-132" id="section-132">&#182;</a>
</div>
<p>Handles caching.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="nx">handleFrameLoad</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">uri</span><span class="p">,</span> <span class="nx">iframe</span><span class="p">,</span> <span class="nx">iframeName</span><span class="p">,</span> <span class="nx">loadCache</span><span class="p">,</span>
                                <span class="nx">storeCacheNow</span><span class="p">,</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-133" id="section-133">&#182;</a>
</div>
<p>Executes callback
and updates GameWindow state.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                                    <span class="nx">that</span><span class="p">.</span><span class="nx">updateLoadFrameState</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span>
                                                              <span class="nx">autoParse</span><span class="p">,</span>
                                                              <span class="nx">autoParseMod</span><span class="p">,</span>
                                                              <span class="nx">autoParsePrefix</span><span class="p">);</span>
                                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-134" id="section-134">&#182;</a>
</div>
<p>Update the frame location:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">iframeWindow</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">uri</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-135" id="section-135">&#182;</a>
</div>
<p>Adding a reference to nodeGame also in the iframe.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">iframeWindow</span><span class="p">.</span><span class="nx">node</span> <span class="o">=</span> <span class="nx">node</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.processuri">
  <h3>
    <a href="#gamewindow.processuri" class="pilcrow">&#182;</a>
    GameWindow.processUri
  </h3>
</div>

  </div>
  <div class="body"><p>Parses a uri string and adds channel uri and prefix, if defined</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uri</span>
      <span class="dox_type">string</span>
      <span>The uri to process</span>
    </div>
    <div class="dox_tag_title">Returns</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name"></span>
      <span class="dox_type">string</span>
      <span>uri The processed uri</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.uriPrefix</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.uriChannel
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">processUri</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uri</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">uri</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;/&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">uri</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">7</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;http://&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">uriPrefix</span><span class="p">)</span> <span class="nx">uri</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uriPrefix</span> <span class="o">+</span> <span class="nx">uri</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">uriChannel</span><span class="p">)</span> <span class="nx">uri</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uriChannel</span> <span class="o">+</span> <span class="nx">uri</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nx">uri</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.updateloadframestate">
  <h3>
    <a href="#gamewindow.updateloadframestate" class="pilcrow">&#182;</a>
    GameWindow.updateLoadFrameState
  </h3>
</div>

  </div>
  <div class="body"><p>Sets window state after a new frame has been loaded</p>

<p>The method performs the following operations:</p>

<ul>
<li>decrements the counter of loading iframes</li>
<li>executes a given callback function</li>
<li>auto parses the elements specified (if any)</li>
<li>set the window state as loaded (eventually)</li>
</ul>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">func</span>
      <span class="dox_type">function</span>
      <span>Optional. A callback function</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">autoParse</span>
      <span class="dox_type">object</span>
      <span>Optional. An object containing elements
   to replace in the HTML DOM.</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">autoParseMod</span>
      <span class="dox_type">string</span>
      <span>Optional. Modifier for search and replace</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">autoParsePrefix</span>
      <span class="dox_type">string</span>
      <span>Optional. Custom prefix to add to the
   keys of the elements in autoParse object</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.searchReplace</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">updateAreLoading
</span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">updateLoadFrameState</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">func</span><span class="p">,</span> <span class="nx">autoParse</span><span class="p">,</span>
                                                         <span class="nx">autoParseMod</span><span class="p">,</span>
                                                         <span class="nx">autoParsePrefix</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">loaded</span><span class="p">,</span> <span class="nx">stageLevel</span><span class="p">;</span>
        <span class="nx">loaded</span> <span class="o">=</span> <span class="nx">updateAreLoading</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">loaded</span><span class="p">)</span> <span class="k">this</span><span class="p">.</span><span class="nx">setStateLevel</span><span class="p">(</span><span class="s1">&#39;LOADED&#39;</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">func</span><span class="p">)</span> <span class="nx">func</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">);</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">autoParse</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">searchReplace</span><span class="p">(</span><span class="nx">autoParse</span><span class="p">,</span> <span class="nx">autoParseMod</span><span class="p">,</span> <span class="nx">autoParsePrefix</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-138" id="section-138">&#182;</a>
</div>
<p>ng event emitter is not used.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">ee</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;FRAME_LOADED&#39;</span><span class="p">);</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">ee</span><span class="p">.</span><span class="nx">stage</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;FRAME_LOADED&#39;</span><span class="p">);</span>
        <span class="nx">node</span><span class="p">.</span><span class="nx">events</span><span class="p">.</span><span class="nx">ee</span><span class="p">.</span><span class="nx">step</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;FRAME_LOADED&#39;</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">loaded</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">stageLevel</span> <span class="o">=</span> <span class="nx">node</span><span class="p">.</span><span class="nx">game</span><span class="p">.</span><span class="nx">getStageLevel</span><span class="p">();</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">stageLevel</span> <span class="o">===</span> <span class="nx">CB_EXECUTED</span><span class="p">)</span> <span class="nx">node</span><span class="p">.</span><span class="nx">emit</span><span class="p">(</span><span class="s1">&#39;LOADED&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">node</span><span class="p">.</span><span class="nx">silly</span><span class="p">(</span><span class="s1">&#39;game-window: &#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">areLoading</span> <span class="o">+</span> <span class="s1">&#39; frames &#39;</span> <span class="o">+</span>
                       <span class="s1">&#39;still loading.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.clearpagebody">
  <h3>
    <a href="#gamewindow.clearpagebody" class="pilcrow">&#182;</a>
    GameWindow.clearPageBody
  </h3>
</div>

  </div>
  <div class="body"><p>Removes all HTML from body, and resets GameWindow</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.reset
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clearPageBody</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
        <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.clearpage">
  <h3>
    <a href="#gamewindow.clearpage" class="pilcrow">&#182;</a>
    GameWindow.clearPage
  </h3>
</div>

  </div>
  <div class="body"><p>Removes all HTML from page and resets GameWindow</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.reset
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">clearPage</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">removeChildrenFromNode</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">documentElement</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.seturiprefix">
  <h3>
    <a href="#gamewindow.seturiprefix" class="pilcrow">&#182;</a>
    GameWindow.setUriPrefix
  </h3>
</div>

  </div>
  <div class="body"><p>Sets the variable uriPrefix</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.uriPrefix
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setUriPrefix</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uriPrefix</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">uriPrefix</span> <span class="o">!==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="s1">&#39;string&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nx">uriPrefix</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.setUriPrefix: uriPrefix must be &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;string or null.&#39;</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">uriPrefix</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">uriPrefix</span> <span class="o">=</span> <span class="nx">uriPrefix</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="gamewindow.seturichannel">
  <h3>
    <a href="#gamewindow.seturichannel" class="pilcrow">&#182;</a>
    GameWindow.setUriChannel
  </h3>
</div>

  </div>
  <div class="body"><p>Sets the variable uriChannel</p>

<p>Trailing and preceding slashes are added if missing.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uriChannel</span>
      <span class="dox_type">string</span>
      <span class="dox_type">null</span>
      <span>The current uri of the channel,
  or NULL to delete it</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.uriChannel
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">GameWindow</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">setUriChannel</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">uriChannel</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="s1">&#39;string&#39;</span> <span class="o">===</span> <span class="k">typeof</span> <span class="nx">uriChannel</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">uriChannel</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="nx">uriChannel</span> <span class="o">=</span> <span class="s1">&#39;/&#39;</span> <span class="o">+</span> <span class="nx">uriChannel</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">uriChannel</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="nx">uriChannel</span><span class="p">.</span><span class="nx">length</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">!==</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">uriChannel</span> <span class="o">=</span> <span class="nx">uriChannel</span> <span class="o">+</span> <span class="s1">&#39;/&#39;</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">uriChannel</span> <span class="o">!==</span> <span class="kc">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nx">TypeError</span><span class="p">(</span><span class="s1">&#39;GameWindow.uriChannel: uriChannel must be &#39;</span> <span class="o">+</span>
                                <span class="s1">&#39;string or null. Found: &#39;</span> <span class="o">+</span> <span class="nx">uriChannel</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">uriChannel</span> <span class="o">=</span> <span class="nx">uriChannel</span><span class="p">;</span>
    <span class="p">};</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap" id="helper-functions">
  <h2>
    <a href="#helper-functions" class="pilcrow">&#182;</a>
    Helper functions
  </h2>
</div>

        </td>
        <td class="code highlight"><div class="highlight"><pre></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="handleframeload">
  <h3>
    <a href="#handleframeload" class="pilcrow">&#182;</a>
    handleFrameLoad
  </h3>
</div>

  </div>
  <div class="body"><p>Handles iframe contents loading</p>

<p>A helper method of GameWindow.loadFrame.
Puts cached contents into the iframe or caches new contents if requested.
Handles reloading of script tags and injected libraries.
Must be called with the current GameWindow instance.
Updates the references to <em>frameWindow</em> and <em>frameDocument</em> if the
iframe name is equal to <em>frameName</em>.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">that</span>
      <span class="dox_type">GameWindow</span>
      <span>The GameWindow instance</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">uri</span>
      <span class="dox_type">uri</span>
      <span>URI to load</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">iframe</span>
      <span class="dox_type">iframe</span>
      <span>The target iframe</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">frameName</span>
      <span class="dox_type">string</span>
      <span>ID of the iframe</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">loadCache</span>
      <span class="dox_type">bool</span>
      <span>Whether to load from cache</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">storeCache</span>
      <span class="dox_type">bool</span>
      <span>Whether to store to cache</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">func</span>
      <span class="dox_type">function</span>
      <span>Callback</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.loadFrame
</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">handleFrameLoad</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">uri</span><span class="p">,</span> <span class="nx">iframe</span><span class="p">,</span> <span class="nx">frameName</span><span class="p">,</span> <span class="nx">loadCache</span><span class="p">,</span>
                             <span class="nx">storeCache</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>

        <span class="kd">var</span> <span class="nx">iframeDocumentElement</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">afterScripts</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-145" id="section-145">&#182;</a>
</div>
<p>Needed for IE8.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">iframe</span> <span class="o">=</span> <span class="nx">W</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">frameName</span><span class="p">);</span>
        <span class="nx">iframeDocumentElement</span> <span class="o">=</span> <span class="nx">W</span><span class="p">.</span><span class="nx">getIFrameDocument</span><span class="p">(</span><span class="nx">iframe</span><span class="p">).</span><span class="nx">documentElement</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">loadCache</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-146" id="section-146">&#182;</a>
</div>
<p>Load frame from cache:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">iframeDocumentElement</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">uri</span><span class="p">].</span><span class="nx">contents</span><span class="p">;</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-147" id="section-147">&#182;</a>
</div>
<p>Update references to frameWindow and frameDocument
if this was the frame of the game.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">frameName</span> <span class="o">===</span> <span class="nx">that</span><span class="p">.</span><span class="nx">frameName</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">frameWindow</span> <span class="o">=</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">;</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">frameDocument</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">getIFrameDocument</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-148" id="section-148">&#182;</a>
</div>
<p>Disable right click in loaded iframe document, if necessary.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">rightClickDisabled</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">J</span><span class="p">.</span><span class="nx">disableRightClick</span><span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">frameDocument</span><span class="p">);</span>
            <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-149" id="section-149">&#182;</a>
</div>
<p>Track onkeydown Escape.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">that</span><span class="p">.</span><span class="nx">conf</span><span class="p">.</span><span class="nx">noEscape</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">frameDocument</span><span class="p">.</span><span class="nx">onkeydown</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">onkeydown</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-150" id="section-150">&#182;</a>
</div>
<p>(Re-)Inject libraries and reload scripts:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">removeLibraries</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
        <span class="nx">afterScripts</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="nx">injectLibraries</span><span class="p">(</span><span class="nx">iframe</span><span class="p">,</span> <span class="nx">that</span><span class="p">.</span><span class="nx">globalLibs</span><span class="p">.</span><span class="nx">concat</span><span class="p">(</span>
                <span class="nx">that</span><span class="p">.</span><span class="nx">frameLibs</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="nx">uri</span><span class="p">)</span> <span class="o">?</span> <span class="nx">that</span><span class="p">.</span><span class="nx">frameLibs</span><span class="p">[</span><span class="nx">uri</span><span class="p">]</span> <span class="o">:</span> <span class="p">[]));</span>

            <span class="k">if</span> <span class="p">(</span><span class="nx">storeCache</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-151" id="section-151">&#182;</a>
</div>
<p>Store frame in cache:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="nx">that</span><span class="p">.</span><span class="nx">cache</span><span class="p">[</span><span class="nx">uri</span><span class="p">].</span><span class="nx">contents</span> <span class="o">=</span> <span class="nx">iframeDocumentElement</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="nx">func</span><span class="p">();</span>
        <span class="p">};</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">loadCache</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">reloadScripts</span><span class="p">(</span><span class="nx">iframe</span><span class="p">,</span> <span class="nx">afterScripts</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">{</span>
            <span class="nx">afterScripts</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="removelibraries">
  <h3>
    <a href="#removelibraries" class="pilcrow">&#182;</a>
    removeLibraries
  </h3>
</div>

  </div>
  <div class="body"><p>Removes injected scripts from iframe</p>

<p>Takes out all the script tags with the className "injectedlib"
that were inserted by injectLibraries.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">iframe</span>
      <span class="dox_type">HTMLIFrameElement</span>
      <span>The target iframe</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">injectLibraries
</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">removeLibraries</span><span class="p">(</span><span class="nx">iframe</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">idx</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">contentDocument</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">scriptNodes</span><span class="p">,</span> <span class="nx">scriptNode</span><span class="p">;</span>

        <span class="nx">contentDocument</span> <span class="o">=</span> <span class="nx">W</span><span class="p">.</span><span class="nx">getIFrameDocument</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-153" id="section-153">&#182;</a>
</div>
<p>Old IEs do not have getElementsByClassName.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">scriptNodes</span> <span class="o">=</span> <span class="nx">W</span><span class="p">.</span><span class="nx">getElementsByClassName</span><span class="p">(</span><span class="nx">contentDocument</span><span class="p">,</span> <span class="s1">&#39;injectedlib&#39;</span><span class="p">,</span>
                                               <span class="s1">&#39;script&#39;</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-154" id="section-154">&#182;</a>
</div>
<p>It was. To check.
scriptNodes = contentDocument.getElementsByClassName('injectedlib');</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">idx</span> <span class="o">&lt;</span> <span class="nx">scriptNodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">idx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">scriptNode</span> <span class="o">=</span> <span class="nx">scriptNodes</span><span class="p">[</span><span class="nx">idx</span><span class="p">];</span>
            <span class="nx">scriptNode</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">scriptNode</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="reloadscripts">
  <h3>
    <a href="#reloadscripts" class="pilcrow">&#182;</a>
    reloadScripts
  </h3>
</div>

  </div>
  <div class="body"><p>Reloads all script nodes in iframe</p>

<p>Deletes and reinserts all the script tags, effectively reloading the
scripts. The placement of the tags can change, but the order is kept.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">iframe</span>
      <span class="dox_type">HTMLIFrameElement</span>
      <span>The target iframe</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">func</span>
      <span class="dox_type">function</span>
      <span>Callback</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">reloadScripts</span><span class="p">(</span><span class="nx">iframe</span><span class="p">,</span> <span class="nx">func</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">contentDocument</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">headNode</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">tag</span><span class="p">,</span> <span class="nx">scriptNodes</span><span class="p">,</span> <span class="nx">scriptNodeIdx</span><span class="p">,</span> <span class="nx">scriptNode</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">attrIdx</span><span class="p">,</span> <span class="nx">attr</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">numLoading</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">needsLoad</span><span class="p">;</span>

        <span class="nx">contentDocument</span> <span class="o">=</span> <span class="nx">W</span><span class="p">.</span><span class="nx">getIFrameDocument</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
        <span class="nx">headNode</span> <span class="o">=</span> <span class="nx">W</span><span class="p">.</span><span class="nx">getIFrameAnyChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-156" id="section-156">&#182;</a>
</div>
<p>Start counting loading tags at 1 instead of 0 and decrement the
count after the loop.
This way the callback cannot be called before the loop finishes.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">numLoading</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

        <span class="nx">scriptNodes</span> <span class="o">=</span> <span class="nx">contentDocument</span><span class="p">.</span><span class="nx">getElementsByTagName</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">scriptNodeIdx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">scriptNodeIdx</span> <span class="o">&lt;</span> <span class="nx">scriptNodes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>
             <span class="nx">scriptNodeIdx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-157" id="section-157">&#182;</a>
</div>
<p>Remove tag:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">tag</span> <span class="o">=</span> <span class="nx">scriptNodes</span><span class="p">[</span><span class="nx">scriptNodeIdx</span><span class="p">];</span>
            <span class="nx">tag</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">tag</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-158" id="section-158">&#182;</a>
</div>
<p>Reinsert tag for reloading:</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="nx">scriptNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">tag</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">)</span> <span class="nx">scriptNode</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
            <span class="nx">needsLoad</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="nx">attrIdx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">attrIdx</span> <span class="o">&lt;</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">attributes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">attrIdx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">attr</span> <span class="o">=</span> <span class="nx">tag</span><span class="p">.</span><span class="nx">attributes</span><span class="p">[</span><span class="nx">attrIdx</span><span class="p">];</span>
                <span class="nx">scriptNode</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="nx">attr</span><span class="p">.</span><span class="nx">name</span><span class="p">,</span> <span class="nx">attr</span><span class="p">.</span><span class="nx">value</span><span class="p">);</span>
                <span class="k">if</span> <span class="p">(</span><span class="nx">attr</span><span class="p">.</span><span class="nx">name</span> <span class="o">===</span> <span class="s1">&#39;src&#39;</span><span class="p">)</span> <span class="nx">needsLoad</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">needsLoad</span><span class="p">)</span> <span class="p">{</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-159" id="section-159">&#182;</a>
</div>
<p>scriptNode.async = true;</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>                <span class="o">++</span><span class="nx">numLoading</span><span class="p">;</span>
                <span class="nx">scriptNode</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">sn</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="nx">sn</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
                        <span class="o">--</span><span class="nx">numLoading</span><span class="p">;</span>
                        <span class="k">if</span> <span class="p">(</span><span class="nx">numLoading</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">func</span><span class="p">();</span>
                    <span class="p">};</span>
                <span class="p">}(</span><span class="nx">scriptNode</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="nx">headNode</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">scriptNode</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="o">--</span><span class="nx">numLoading</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">numLoading</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="nx">func</span><span class="p">();</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="injectlibraries">
  <h3>
    <a href="#injectlibraries" class="pilcrow">&#182;</a>
    injectLibraries
  </h3>
</div>

  </div>
  <div class="body"><p>Injects scripts into the iframe</p>

<p>Inserts <code>&lt;script class="injectedlib" src="..."&gt;</code> lines into given
iframe object, one for every given library.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">iframe</span>
      <span class="dox_type">HTMLIFrameElement</span>
      <span>The target iframe</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">libs</span>
      <span class="dox_type">array</span>
      <span>An array of strings giving the "src" attribute for
  the <code>&lt;script&gt;</code> lines to insert</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">injectLibraries</span><span class="p">(</span><span class="nx">iframe</span><span class="p">,</span> <span class="nx">libs</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">headNode</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">scriptNode</span><span class="p">;</span>
        <span class="kd">var</span> <span class="nx">libIdx</span><span class="p">,</span> <span class="nx">lib</span><span class="p">;</span>

        <span class="nx">headNode</span> <span class="o">=</span> <span class="nx">W</span><span class="p">.</span><span class="nx">getIFrameAnyChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>

        <span class="k">for</span> <span class="p">(</span><span class="nx">libIdx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">libIdx</span> <span class="o">&lt;</span> <span class="nx">libs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">libIdx</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">lib</span> <span class="o">=</span> <span class="nx">libs</span><span class="p">[</span><span class="nx">libIdx</span><span class="p">];</span>
            <span class="nx">scriptNode</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;script&#39;</span><span class="p">);</span>
            <span class="nx">scriptNode</span><span class="p">.</span><span class="nx">className</span> <span class="o">=</span> <span class="s1">&#39;injectedlib&#39;</span><span class="p">;</span>
            <span class="nx">scriptNode</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">lib</span><span class="p">;</span>
            <span class="nx">headNode</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">scriptNode</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="updateareloading">
  <h3>
    <a href="#updateareloading" class="pilcrow">&#182;</a>
    updateAreLoading
  </h3>
</div>

  </div>
  <div class="body"><p>Updates the counter of loading frames</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">that</span>
      <span class="dox_type">GameWindow</span>
      <span>A reference to the GameWindow instance</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">update</span>
      <span class="dox_type">number</span>
      <span>The number to add to the counter</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.lockedUpdate
</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">updateAreLoading</span><span class="p">(</span><span class="nx">that</span><span class="p">,</span> <span class="nx">update</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">that</span><span class="p">.</span><span class="nx">areLoading</span> <span class="o">=</span> <span class="nx">that</span><span class="p">.</span><span class="nx">areLoading</span> <span class="o">+</span> <span class="nx">update</span><span class="p">;</span>
        <span class="k">return</span> <span class="nx">that</span><span class="p">.</span><span class="nx">areLoading</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="adaptframe2headerposition">
  <h3>
    <a href="#adaptframe2headerposition" class="pilcrow">&#182;</a>
    adaptFrame2HeaderPosition
  </h3>
</div>

  </div>
  <div class="body"><p>Sets a CSS class to the frame element depending on the header position</p>

<p>The frame element must exists or an error will be thrown.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">W</span>
      <span class="dox_type">GameWindow</span>
      <span>The current GameWindow object</span>
    </div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">oldHeaderPos</span>
      <span class="dox_type">string</span>
      <span>Optional. The previous position of the
  header</span>
    </div>
    <div class="dox_tag_title">API</div>
    <div class="dox_tag_detail">
      <span class="dox_type">private
</span>
    </span>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">adaptFrame2HeaderPosition</span><span class="p">(</span><span class="nx">W</span><span class="p">,</span> <span class="nx">oldHeaderPos</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">position</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">W</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nb">Error</span><span class="p">(</span><span class="s1">&#39;adaptFrame2HeaderPosition: frame not found.&#39;</span><span class="p">);</span>
        <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-163" id="section-163">&#182;</a>
</div>
<p>If no header is found, simulate the 'top' position to better
fit the whole screen.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="nx">position</span> <span class="o">=</span> <span class="nx">W</span><span class="p">.</span><span class="nx">headerPosition</span> <span class="o">||</span> <span class="s1">&#39;top&#39;</span><span class="p">;</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-164" id="section-164">&#182;</a>
</div>
<p>When we move from bottom to any other configuration, we need
to move the header before the frame.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">oldHeaderPos</span> <span class="o">===</span> <span class="s1">&#39;bottom&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">position</span> <span class="o">!==</span> <span class="s1">&#39;bottom&#39;</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">W</span><span class="p">.</span><span class="nx">getFrameRoot</span><span class="p">().</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">W</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">,</span> <span class="nx">W</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="nx">W</span><span class="p">.</span><span class="nx">removeClass</span><span class="p">(</span><span class="nx">W</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">,</span> <span class="s1">&#39;ng_mainframe-header-[a-z-]*&#39;</span><span class="p">);</span>
        <span class="k">switch</span><span class="p">(</span><span class="nx">position</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">case</span> <span class="s1">&#39;right&#39;</span><span class="o">:</span>
            <span class="nx">W</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">W</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">,</span> <span class="s1">&#39;ng_mainframe-header-vertical-r&#39;</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;left&#39;</span><span class="o">:</span>
            <span class="nx">W</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">W</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">,</span> <span class="s1">&#39;ng_mainframe-header-vertical-l&#39;</span><span class="p">);</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;top&#39;</span><span class="o">:</span>
            <span class="nx">W</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">W</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">,</span> <span class="s1">&#39;ng_mainframe-header-horizontal&#39;</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-165" id="section-165">&#182;</a>
</div>
<p>There might be no header yet.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">W</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">W</span><span class="p">.</span><span class="nx">getFrameRoot</span><span class="p">().</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">W</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">,</span> <span class="nx">W</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s1">&#39;bottom&#39;</span><span class="o">:</span>
            <span class="nx">W</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="nx">W</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">,</span> <span class="s1">&#39;ng_mainframe-header-horizontal&#39;</span><span class="p">);</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-166" id="section-166">&#182;</a>
</div>
<p>There might be no header yet.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>            <span class="k">if</span> <span class="p">(</span><span class="nx">W</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">W</span><span class="p">.</span><span class="nx">getFrameRoot</span><span class="p">().</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">W</span><span class="p">.</span><span class="nx">headerElement</span><span class="p">,</span>
                                              <span class="nx">W</span><span class="p">.</span><span class="nx">frameElement</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs"><div class="dox">
  <div class="summary">
<div class="pilwrap" id="testdirectframedocumentaccess">
  <h3>
    <a href="#testdirectframedocumentaccess" class="pilcrow">&#182;</a>
    testDirectFrameDocumentAccess
  </h3>
</div>

  </div>
  <div class="body"><p>Tests whether the content of the frameDocument can be accessed directly</p>

<p>The value of the test is stored under <code>directFrameDocumentAccess</code>.</p>

<p>Some IEs give 'Permission denied' when accessing the frame document
directly. In such a case, we need to re-get it from the DOM.</p>
  </div>
  <div class="details">
    <div class="dox_tag_title">Params</div>
    <div class="dox_tag_detail">
      <span class="dox_tag_name">that</span>
      <span class="dox_type">GameWindow</span>
      <span>This instance</span>
    </div>
    <div class="dox_tag_title">See</div>
    <div class="dox_tag_detail">
      <span class="dox_type">GameWindow.directFrameDocumentAccess
  </span>
    </div>
  </div>
</div>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="kd">function</span> <span class="nx">testDirectFrameDocumentAccess</span><span class="p">(</span><span class="nx">that</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">frameDocument</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;test&#39;</span><span class="p">);</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">directFrameDocumentAccess</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">catch</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">that</span><span class="p">.</span><span class="nx">directFrameDocumentAccess</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-168" id="section-168">&#182;</a>
</div>
<p>Expose GameWindow prototype to the global object.</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="nx">node</span><span class="p">.</span><span class="nx">GameWindow</span> <span class="o">=</span> <span class="nx">GameWindow</span><span class="p">;</span>

<span class="p">})(</span></pre></div>
        </td>
      </tr>
      <tr>
        <td class="docs">
<div class="pilwrap">
  <a class="pilcrow" href="#section-169" id="section-169">&#182;</a>
</div>
<p>GameWindow works only in the browser environment. The reference
to the node.js module object is for testing purpose only</p>
        </td>
        <td class="code highlight"><div class="highlight"><pre>    <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nb">window</span><span class="p">)</span> <span class="o">?</span> <span class="nb">window</span> <span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nb">window</span><span class="p">,</span>
    <span class="p">(</span><span class="s1">&#39;undefined&#39;</span> <span class="o">!==</span> <span class="k">typeof</span> <span class="nb">window</span><span class="p">)</span> <span class="o">?</span> <span class="nb">window</span><span class="p">.</span><span class="nx">node</span> <span class="o">:</span> <span class="nx">module</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">exports</span><span class="p">.</span><span class="nx">node</span>
<span class="p">);</span>
</pre></div>
        </td>
      </tr>
  </tbody>
</table>
  </div>
</body>
</html>
